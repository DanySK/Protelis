module protelis:lang:channel
import protelis:lang:spreading

def dilate(region, width) {
    distanceTo2(region, nbrRangeHop) < width
}

public def channel(source, dest, thr) {
	let ds = distanceTo2(source, nbrRangeHop);
	let dd = distanceTo2(dest, nbrRangeHop);
	let d = distance2(source, dest, nbrRangeHop);
	env.put("distanceS", ds);
	env.put("distanceD", dd);
	env.put("distanceSD", d);
	if(d == Infinity) { false } else { ds + dd <= d + thr }
//	distanceTo2(source, nbrRangeHop) + distanceTo2(dest, nbrRangeHop) <= distance2(source, dest, nbrRangeHop) + thr
}

public def dilatedChannel(source, dest, thr, width) {
	dilate(channel(source, dest, thr), width)
}