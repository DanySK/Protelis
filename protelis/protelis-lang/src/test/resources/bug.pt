module protelis:lang:spreading2

public def G(source, initial, metric, accumulate) {
    rep(distanceValue <- [Infinity, initial]) {
        mux(source) {
            [0, initial]
        } else {
            let ndv = nbr(distanceValue);
            minHood ([
                metric.apply() + ndv.get(0),
                accumulate.apply(ndv.get(1))
            ])
        }
    }.get(1) 
}

public def nbrRange() {
    self.nbrRange()
}

public def distanceTo(source) {
    G(source, 0, nbrRange, (v) -> {v + nbrRange()})
}

distanceTo(env.has("source"))